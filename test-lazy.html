<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Galaxy Test - Lazy Load</title>

    <style>
      .container {
        height: 500px;
        width: 50%;
        border: 1px solid green;
        padding: 20px;
        box-sizing: border-box;
        position: relative;
      }
      .content-1 {
        border: 1px solid red;
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
      }

      .hover-effect {
        background-color: aquamarine;
      }

      /* Loading skeleton for Klaviyo forms */
      [class^="klaviyo-form-"] {
        min-height: 100px;
        position: relative;
        margin-bottom: 20px;
      }

      [class^="klaviyo-form-"]::before {
        content: "";
        display: block;
        height: 100px;
        background: linear-gradient(
          90deg,
          #f0f0f0 25%,
          #e8e8e8 50%,
          #f0f0f0 75%
        );
        background-size: 200% 100%;
        animation: klaviyo-loading 1.5s infinite;
        border-radius: 4px;
      }

      [class^="klaviyo-form-"].klaviyo-loaded::before {
        display: none;
      }

      @keyframes klaviyo-loading {
        0% {
          background-position: 200% 0;
        }
        100% {
          background-position: -200% 0;
        }
      }
    </style>
  </head>
  <body style="margin: 0">
    <div class="klaviyo-form-YanyUp"></div>
    <div class="klaviyo-form-StNbGd"></div>
    <div class="klaviyo-form-SHwSjN"></div>
    <div class="klaviyo-form-RmF6gM"></div>

    <script>
      (function () {
        // Single flag to prevent duplicate script loading
        let klaviyoScriptLoaded = false;
        let klaviyoInitialized = false;

        // Get all form containers
        const formContainers = document.querySelectorAll(
          '[class^="klaviyo-form-"]'
        );

        function initKlaviyoForms() {
          if (klaviyoInitialized) return;
          klaviyoInitialized = true;

          // Remove loading skeleton after forms render
          setTimeout(() => {
            formContainers.forEach((form) => {
              form.classList.add("klaviyo-loaded");
            });
          }, 800);
        }

        function loadKlaviyoScript() {
          if (klaviyoScriptLoaded) return;
          klaviyoScriptLoaded = true;

          // Add preconnect dynamically when we actually need to load
          const preconnect = document.createElement("link");
          preconnect.rel = "preconnect";
          preconnect.href = "https://static.klaviyo.com";
          preconnect.crossOrigin = "anonymous";
          document.head.appendChild(preconnect);

          // Load the script
          const script = document.createElement("script");
          script.type = "text/javascript";
          script.async = true;
          script.src =
            "https://static.klaviyo.com/onsite/js/klaviyo.js?company_id=YwabkH";
          script.onload = initKlaviyoForms;
          document.head.appendChild(script);
        }

        // Lazy load with Intersection Observer
        if ("IntersectionObserver" in window && formContainers.length > 0) {
          const observer = new IntersectionObserver(
            (entries) => {
              // Load when ANY form becomes visible
              const anyVisible = entries.some((entry) => entry.isIntersecting);
              if (anyVisible) {
                loadKlaviyoScript();
                observer.disconnect();
              }
            },
            {
              rootMargin: "100px", // Start loading 100px before form enters viewport
              threshold: 0.01,
            }
          );

          // Observe all forms
          formContainers.forEach((container) => observer.observe(container));

          // Fallback: auto-load after 2 seconds if user doesn't scroll
          setTimeout(loadKlaviyoScript, 2000);
        } else {
          // No IntersectionObserver support - load immediately
          loadKlaviyoScript();
        }
      })();

      // DOM-related scripts
      document.addEventListener("DOMContentLoaded", () => {
        console.log("before form ");
        const form = document.querySelector('[data-testid="hiahiahia"]');
        console.log("form ", form);

        const innerContainer = document.querySelector(".content-1");

        if (innerContainer) {
          innerContainer.addEventListener("mouseenter", () => {
            innerContainer.classList.add("hover-effect");
          });

          innerContainer.addEventListener("mouseleave", () => {
            innerContainer.classList.remove("hover-effect");
          });
        }
      });
    </script>
  </body>
</html>
